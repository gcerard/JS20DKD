<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twibbon Generator</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
        }
        .container {
            text-align: center;
        }
        .btn {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        canvas {
            border: 1px solid #ccc;
            width: 500px;  /* Display size */
            height: 500px; /* Display size */
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Twibbon Generator</h2>
        <input type="file" id="fileInput" accept="image/*">
        <br><br>
        <button class="btn" onclick="generateTwibbon()">Generate Twibbon</button>
        <br><br>
        <canvas id="canvas" width="1080" height="1080" style="display: none;"></canvas>
        <canvas id="displayCanvas" width="500" height="500"></canvas>
        <br><br>
        <button class="btn" onclick="downloadImage()">Download Image</button>
    </div>

    <script>
        let img = new Image();
        let frameImg = new Image();
        frameImg.src = 'twibbon.png'; // Update with your frame image path
        let displayCanvas, displayCtx, canvas, ctx;
        let isDragging = false;
        let startX, startY;
        let imgX = 0, imgY = 0;
        let imgScale = 1;

        function generateTwibbon() {
            const fileInput = document.getElementById('fileInput');
            canvas = document.getElementById('canvas');
            ctx = canvas.getContext('2d');
            displayCanvas = document.getElementById('displayCanvas');
            displayCtx = displayCanvas.getContext('2d');

            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    img.onload = function() {
                        drawImage();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);

                // Add event listeners for repositioning the image
                displayCanvas.addEventListener('mousedown', startDragging);
                displayCanvas.addEventListener('mousemove', dragImage);
                displayCanvas.addEventListener('mouseup', stopDragging);
                displayCanvas.addEventListener('mouseout', stopDragging);
                displayCanvas.addEventListener('wheel', resizeImage);
            } else {
                alert('Please upload an image file.');
            }
        }

        function drawImage() {
            // Calculate scale ratio between display and actual canvas
            const scale = displayCanvas.width / canvas.width;

            // Draw on the actual canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(img, imgX, imgY, img.width * imgScale, img.height * imgScale);
            ctx.drawImage(frameImg, 0, 0, canvas.width, canvas.height);

            // Draw on the display canvas
            displayCtx.clearRect(0, 0, displayCanvas.width, displayCanvas.height);
            displayCtx.drawImage(canvas, 0, 0, canvas.width * scale, canvas.height * scale);
        }

        function startDragging(e) {
            const scale = canvas.width / displayCanvas.width;
            isDragging = true;
            startX = e.offsetX * scale - imgX;
            startY = e.offsetY * scale - imgY;
        }

        function dragImage(e) {
            if (isDragging) {
                const scale = canvas.width / displayCanvas.width;
                imgX = e.offsetX * scale - startX;
                imgY = e.offsetY * scale - startY;
                drawImage();
            }
        }

        function stopDragging() {
            isDragging = false;
        }

        function resizeImage(e) {
            if (e.deltaY < 0) {
                imgScale *= 1.1;
            } else {
                imgScale /= 1.1;
            }
            drawImage();
        }

        function downloadImage() {
            const link = document.createElement('a');
            link.download = 'twibbon.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }
    </script>
</body>
</html>
